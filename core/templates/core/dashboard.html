<!DOCTYPE html>
<html lang="es">

{% load static %}

<head>
    <meta charset="UTF-8">
    <title>Dashboard - Familia Torres - Navidad 2025</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous"
    >
    <link
        href="{% static 'core/css/custom-db.css' %}"
        rel="stylesheet"
    >
</head>

<body class="bg-dark text-light">
    <div class="container w-75 mx-auto pt-3">
        <div class="bg-light text-dark rounded-5 shadow-lg p-4">
            <header class="mb-4">
                <h1 class="h1 text-center mb-1">Familia Torres</h1>
                <h5 class="h5 text-center text-muted mb-0">Navidad 2025</h5>
            </header>
            <nav class="mb-4 navbar bg-light rounded-4 shadow shadow-md p-2 justify-content-center w-50 mx-auto">
                <ul class="nav nav-pills justify-content-center">
                    <li class="nav-item">
                        <a class="nav-link link-success " href="{% url 'dashboard' %}">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-success" href="#confirmados">Confirmar asistencia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-success" href="#amigosecreto">Amigo secreto</a>
                    </li>
                    {% if request.session.guest_username == "hugorivera1" %}
                    <li class="nav-item">
                        <a class="nav-link link-success" href="{% url 'console' %}">Panel de control</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            <!--User info section div-->
            <div class="bg-light text-dark p-3 align-items-center d-flex flex-column">
                <p>Hola, <b>{{ request.session.guest_name }}</b></p>
                <p>Tu asistencia es <b>{% if request.session.guest_confirmed %}Confirmada{% else %}No confirmada{% endif %}</b>!</p>
                <a href="{% url 'logout' %}" class="btn btn-danger btn-sm">Salir</a>
            </div>
            <!-- CARD: Cena -->
            <div class="card mb-3">
                <div class="card-header bg-secondary text-white h5">
                    üçï Cena
                </div>
                <div class="card-body">
                    <h5 class="card-title">Detalles de la cena</h5>
                    <p class="card-text">
                        Se llevar√° a cabo en la Residencia Rivera Torres a el 24 de diciembre a las 8:00 PM. El dress code es tem√°tica navide√±a.
                        El men√∫ incluir√° las siguientes opciones:
                        <ul>
                            <li>Tamales variados</li>
                            <li>Carne con chile verde al estilo Blanca's</li>
                            <li>Pierna en adobo</li>
                            <li>Mole con pollo</li>
                            <li>Pizza para los peques</li>
                            <li>Ensalad al estilo Oli's</li>
                            <li>Pasta con crema</li>
                            <li>Frijoles refritos</li>
                            <li>Pastel navide√±o</li>
                            <li>Bebidas sin alcohol</li>
                        </ul>
                        Sobre las bebidas alcoh√≥licas, cada quien puede traer lo que prefiera.
                    </p>
                </div>
            </div>
            <!-- CARD: Juegos -->
            <div class="card mb-3">
                <div class="card-header bg-secondary text-white h5">
                    üßô Actividades
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Realizaremos varias actividades para animar la noche, incluyendo:
                        <ul>
                            <li>üé≤ Juegos dinamicos con premios sorpresa</li>
                            <li>üéÅ Intercambio de regalos navide√±os - Amigo Secreto</li>
                            <b>Nota:</b> confirmar asistencia para participar en el intercambio.
                            <li>ü´† Intercambio de regalos chuscos</li>
                            <b>Nota:</b> traer un regalo chusco.
                            <li>ü§ó Abrazo navide√±o</li>
                        </ul>
                        Sobre las bebidas alcoh√≥licas, cada quien puede traer lo que prefiera.
                    </p>
                </div>
            </div>
            <!-- CARD: Confirmados -->
            <!--Anchor-->
            <div class="card mb-3 shadow shadow-lg" id="confirmados">
                <div class="card-header bg-success text-white h5">
                    Asistentes Confirmados
                </div>
                <div class="card-body">
                    <div class="mb-4 navbar rounded-4 shadow shadow-md p-2 justify-content-center w-50 mx-auto">
                    {% if not request.session.guest_confirmed %}
                    <p>
                        Si a√∫n no has confirmado, por favor hazlo lo antes posible para ayudarnos con la planificaci√≥n.
                    </p>
                    <a class="btn btn-success btn-sm" href="{% url 'confirm_assistance' %}?action=confirm">
                        Confirmar asistencia
                    </a>
                    {% else %}
                    <p>¬°Gracias por confirmar tu asistencia! Estamos emocionados de verte en la celebraci√≥n.</p>
                    <a class="btn btn-danger btn-sm m-4" href="{% url 'confirm_assistance' %}?action=cancel">
                        Cancelar mi asistencia
                    </a>
                    {% endif %}
                    </div>
                    <p class="card-text">
                        Hasta ahora, los invitados de las siguientes familias han confirmado su asistencia:
                    </p>
                    <ul>
                        {% for family_group in confirmed_family_groups %}
                            <li class="list-group-item"><b><br>‚úÖ Fam. {{ family_group.family_name }}:<br></b>
                                <ul class="list-group shadow shadow-sm">
                                    {% for guest in family_group.guests.all %}
                                        <li class="list-group-item">{{ guest.name }}</li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% empty %}
                            <li>No hay confirmaciones a√∫n.</li>
                        {% endfor %}
                    </ul>
                    
                </div>
            </div>
             <!-- CARD: Amigo Secreto -->
            <div class="card mb-3 shadow shadow-lg" id="amigosecreto">
                <div class="card-header bg-secondary text-white h5">
                    üéÅ Amigo Secreto
                </div>
                <div class="card-body align-center justify-content-center">
                    <p class="card-text">
                    ¬°Bienvenido al Amigo Secreto! Aqu√≠ no hay pierde, solo buena vibra, risas!!!
                    <h6 class="card-text m-2">Presupuesto:</h6>
                    <p class="card-text">El regalo debe estar entre $300 y $500 MXN.</p>
                    <h6 class="card-text m-2">Actualizar tu regalo ideal:</h6>
                    <p class="card-text">Ay√∫danle a tu amigo secreto a atinarle: escribe qu√© te gustar√≠a recibir en el texto de abajo. Puedes cambiar tu idea las veces que quieras</p>
                    <h6 class="card-text m-2">Ver mi amigo secreto:</h6>
                    <p class="card-text">El bot√≥n ‚ÄúVer mi amigo secreto‚Äù revela el gran misterio‚Ä¶ sl dar clic, sabr√°s a qui√©n te toca regalarle. Ese nombre es top secret, as√≠ que no lo quemes.</p>
                    <h6 class="card-text m-2">Notas:</h6>
                    <p class="card-text">
                        <ul>
                            <li>Debes haber confirmado tu asistencia para participar en el Amigo Secreto.</li>
                            <li>Recuerda que el objetivo es divertirse y compartir momentos agradables en familia.</li>
                            <li>El dia del evento llevar solamente el regalo de tu amigo secreto.</li>
                        </ul>
                    </p>
                    <div class="mb-4 navbar rounded-4 shadow shadow-md p-2 justify-content-center w-50 mx-auto">
                        <p class="h4">Mi regalo ideal ser√≠a:</p>
                        <input
                            type="text"
                            class="form-control m-2"
                            id="gift_idea"
                            name="gift_idea"
                            placeholder="{% if request.session.ideal_gift %}Anterior: {{ request.session.ideal_gift }}{% else %}Escribe tu idea de regalo aqu√≠{% endif %}"
                            value="{% if request.session.ideal_gift %}{{ request.session.ideal_gift }}{% endif %}"
                        >
                        <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const input = document.getElementById("gift_idea");
                            const link = document.getElementById("save_gift_idea_btn");

                            function updateLink() {
                                const value = input.value.trim();

                                if (value === "") {
                                    link.style.display = "none";
                                    link.href = "#";
                                } else {
                                    const encoded = encodeURIComponent(value);
                                    link.href = "{% url 'save_gift_idea' %}?action=save_gift_idea&gift_idea=" + encoded;
                                    link.style.display = "inline-block";
                                }
                            }
                            updateLink();
                            input.addEventListener("input", updateLink);
                        });
                        </script>
                        <a class="btn btn-outline-success btn-sm m-1" id="save_gift_idea_btn" href="#" style="display: none;">
                            Guardar mi idea de regalo
                        </a> 
                        <a class="btn btn-outline-success btn-sm m-1" type="button" href="{% url 'view_secret_friend' %}">
                            Ver mi Amigo Secreto
                        </a>
                    </div>
                </div>
            </div>
            <footer class="mt-4 text-center text-muted small">
                &copy; 2025 - Familia Torres
            </footer>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-IQsoLXlXrmkaI0s5momkGLumZ5qX6Ch12RSaxJXiiMQuILzcuAJ6Digw1P3D6Z0Z" crossorigin="anonymous">
    </script>
</body>
</html>