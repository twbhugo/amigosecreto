{% load static %}
<html>
<head>
    <meta charset="UTF-8">
    <title>Mi amigo secreto - Familia Torres - Navidad 2025</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous"
    >
    <link
        href="{% static 'core/css/custom-confirmation.css' %}"
        rel="stylesheet"
    >
</head>
<body>
    <div class="container mt-5">
        <div class="alert alert-success text-center rounded-4 shadow shadow-md p-2 justify-content-center" role="alert">
            <div class="reveal-card">
                <h4 class="mb-3 text-dark">¬°Hola {{ request.session.guest_name }}!</h4>
                <div class="reveal-header">
                    <h5 class="text-dark m-0">Tu amigo secreto es:</h5>
                    <button id="revealBtn" class="reveal-btn" type="button">
                    üéÅ Descubrir
                    </button>
                </div>
                <div id="revealBox" class="reveal-box">
                    <div class="shine"></div>
                    <h1 class="secret-name mb-2">{{ secret_friend_name }}</h1>
                    <p class="mb-3">De la familia <strong>{{ secret_friend_family_group }}</strong></p>
                    <h5 class="text-dark mb-2">Su regalo ideal es:</h5>
                    <h3 class="secret-gift mb-0">{{ secret_friend_ideal_gift }}</h3>
                </div>
                <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
                <a href="{% url 'dashboard' %}" class="btn btn-danger btn-lg mt-4">Volver al Inicio</a>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
        const revealBtn = document.getElementById("revealBtn");
        const revealBox = document.getElementById("revealBox");
        const canvas = document.getElementById("confettiCanvas");
        const ctx = canvas.getContext("2d");

        // Inicia ‚Äúoculto‚Äù
        revealBox.classList.add("is-locked");

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = Math.floor(rect.width * dpr);
            canvas.height = Math.floor(rect.height * dpr);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        // Confetti simple
        function confettiBurst(durationMs = 1200) {
            const rect = canvas.getBoundingClientRect();
            const W = rect.width, H = rect.height;

            const pieces = Array.from({ length: 120 }, () => ({
            x: W * (0.2 + Math.random() * 0.6),
            y: H * 0.2,
            vx: (Math.random() - 0.5) * 6,
            vy: (Math.random() * -6) - 2,
            g: 0.18 + Math.random() * 0.12,
            s: 4 + Math.random() * 4,
            r: Math.random() * Math.PI,
            vr: (Math.random() - 0.5) * 0.25,
            a: 1
            }));

            const start = performance.now();

            function frame(now) {
            const t = now - start;
            ctx.clearRect(0, 0, W, H);

            for (const p of pieces) {
                p.vy += p.g;
                p.x += p.vx;
                p.y += p.vy;
                p.r += p.vr;
                p.a = Math.max(0, 1 - t / durationMs);

                ctx.save();
                ctx.globalAlpha = p.a;
                ctx.translate(p.x, p.y);
                ctx.rotate(p.r);
                ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
                ctx.restore();
            }

            if (t < durationMs) requestAnimationFrame(frame);
            else ctx.clearRect(0, 0, W, H);
            }

            // Deja que el navegador elija colores default (se ven distintos por compositor),
            // y evitamos hardcodear una paleta. Si quieres paleta navide√±a, te la pongo.
            ctx.fillStyle = "black";
            requestAnimationFrame(frame);
        }

        revealBtn.addEventListener("click", () => {
            revealBox.classList.remove("is-locked");
            revealBox.classList.add("is-revealed");

            revealBtn.disabled = true;
            revealBtn.textContent = "‚úÖ Revelado";

            confettiBurst();
        });
        });
    </script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"
    ></script>
</body>
</html>